{"ast":null,"code":"import _toConsumableArray from\"C:/wamp64/www/Projet_TER/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/wamp64/www/Projet_TER/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/wamp64/www/Projet_TER/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import $,{get}from'jquery';import axios from'axios';import ReactFlow,{addEdge,ReactFlowProvider,removeElements}from'react-flow-renderer';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faTrashAlt}from'@fortawesome/free-solid-svg-icons';import Loader from'../components/Loader';import Toolbar from'../components/Toolbar';import CustomNode from'../components/tree/CustomNode';import DebugNode from'../components/tree/DebugNode';import ModalEditCritere from'../components/modal/tree/ModalEditCritere';import ModalEditEdge from'../components/modal/tree/ModalEditEdge';import ModalEditMethod from'../components/modal/tree/ModalEditMethod';import ModalEditEndNode from'../components/modal/tree/ModalEditEndNode';import ModalWarning from'../components/modal/ModalWarning';import ModalInformation from'../components/modal/ModalInformation';import ModalConfirmation from'../components/modal/ModalConfirmation';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Tree(){var nodeTypes={critereNode:CustomNode,debugNode:DebugNode};var colors=['black','marron','blue','red','purple','fushia','green','lime','yellow','navy','aqua','aquamarine','chocolate','coral','crimson','darkcyan','darkgreen','darkorange','darkseagreen','deeppink','gold','indgo','lightcoral'];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),initialTree=_useState2[0],setInitialTree=_useState2[1];// const [resources, setResources] = useState(null);\nvar _useState3=useState(\"1\"),_useState4=_slicedToArray(_useState3,2),nextId=_useState4[0],setNextId=_useState4[1];var _useState5=useState(\"D1\"),_useState6=_slicedToArray(_useState5,2),nextEdgeId=_useState6[0],setNextEdgeId=_useState6[1];var _useState7=useState(\"M1\"),_useState8=_slicedToArray(_useState7,2),nextMethodId=_useState8[0],setNextMethodId=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),elements=_useState10[0],setElements=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),remove=_useState12[0],setRemove=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),errorMessage=_useState14[0],setErrorMessage=_useState14[1];var reactFlowWrapper=useRef(null);var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),reactFlowInstance=_useState16[0],setReactFlowInstance=_useState16[1];var onElementsRemove=function onElementsRemove(elementsToRemove){return setElements(function(els){return removeElements(elementsToRemove,els);});};var onConnect=function onConnect(params){return setElements(function(els){return addEdge(_objectSpread(_objectSpread({},params),{},{id:getEdgeId(),arrowHeadType:'arrowclosed',label:'',type:'smoothstep'}),els,setNextEdgeId(\"D\"+(parseInt(nextEdgeId.slice(1))+1).toString()));});};// HOOKS REACT-FLOW\nvar onDragOver=function onDragOver(event){event.preventDefault();event.dataTransfer.dropEffect='move';};var onDrop=function onDrop(event){event.preventDefault();//check if input/output already exists\nvar type=event.dataTransfer.getData('application/reactflow');if(type!=null&&type==\"input\"||type==\"output\"){if(checkExist(type)){return alert(\"Désolé, il ne peut y avoir qu'un seul noeud de type \"+type);}}var reactFlowBounds=reactFlowWrapper.current.getBoundingClientRect();var toolbarWidth=$('aside').width();var position=reactFlowInstance.project({x:event.clientX-toolbarWidth,y:event.clientY-reactFlowBounds.top});createNode(type,position);};var onElementClick=function onElementClick(event,element){if(!remove){switch(element.type){case'critereNode':openModalEditCritere(element);break;case'default':openModalEditMethod(element);break;case'smoothstep':openModalEditEdge(element);break;case'input':alert(\"Cannot modify start node\");break;case'output':openModalEditEndNode(element);break;}}else{if(element.type!=\"smoothstep\"){var edges=elements.filter(function(item){return item.type===\"smoothstep\";});var attachedEdges=edges.filter(function(item){return item.source===element.id||item.target===element.id;});if(attachedEdges.length>0){alert(\"You must remove all edges from this element\");}else{openModalConfirmation(element);// deleteElement(element); \n}}else{openModalConfirmation(element);// deleteElement(element); \n}}};var onPaneClick=function onPaneClick(event){event.preventDefault();};// FUNCTIONS\n// return les prochains ID utilisable\nfunction getId(){return nextId;}function getEdgeId(){return nextEdgeId;}function getMethodId(){return nextMethodId;}/*\r\n    crée un noeud de type :\r\n        - input\r\n        - output\r\n        - default (method)\r\n        - critereNode (critere)\r\n\r\n    parametres :\r\n        - type : type du noeud\r\n        - position : position du client si noeud créer via toolbar ou position x et y stocké en bd\r\n        - data : toutes les data du noeud de la BD, si noeud créer via toolbar le label et générer par défault\r\n    */function createNode(type,position,data){var newNode;switch(type){case'input':// noeud entree\nnewNode={id:\"0\",type:type,position:position,data:{label:\"\".concat(type,\" node\")}};break;case'output':// noeud sortie\nnewNode={id:\"S0\",type:type,position:position,data:{label:\"\".concat(type,\" node\"),message:data?data.Message:null}};break;case'critereNode':// noeud critere\nif(data){newNode={id:data.ID_Critere,type:type,position:position,data:{label:data.Libelle,informations:data.Informations?data.Informations:null}};if(data.ID_Critere>=getId()){setNextId((parseInt(data.ID_Critere)+1).toString());}}else{newNode={id:getId(),type:type,position:position,data:{label:\"default critere label\"}};setNextId((parseInt(nextId)+1).toString());}break;case'default':// noeud methode\nif(data){newNode={id:\"M\"+data.ID_Methode,type:type,position:position,data:{label:data.Libelle,description:data.Description,productedData:data.Donnees_produites,workforce:data.Effectif_preconise,method:data.Type_methode,analysis:data.Type_analyse,exemple:data.Exemple}};if(parseInt(data.ID_Methode)>=getMethodId().slice(1)){setNextMethodId(\"M\"+(parseInt(data.ID_Methode)+1).toString());}}else{newNode={id:getMethodId(),type:type,position:position,data:{label:\"default method label\"}};setNextMethodId(\"M\"+(parseInt(getMethodId().slice(1))+1).toString());}break;}// insertion du noeud dans les elements react flow render\nsetElements(function(es){return es.concat(newNode);});}// crée un lien entre 2 noeuds\nfunction createEdge(id,id_source,id_target,label,color){var newEdge={id:id,source:id_source,target:id_target,type:'smoothstep',arrowHeadType:'arrowclosed',label:label,style:{stroke:color}};setElements(function(es){return es.concat(newEdge);});}// check if a node type already exists\nfunction checkExist(type){if(elements){for(var i=0;i<elements.length;i++){if(elements[i].type==type){return true;}}return false;}else{return true;}}// gestion de la supression\nfunction deleteMode(){remove?setRemove(false):setRemove(true);}function deleteElement(element){var selectedElement=elements.find(function(el){return el.id===element.id;});var index=elements.indexOf(selectedElement);setElements(elements.filter(function(item){return elements.indexOf(item)!==index;}));}useEffect(function(){if(remove){$(\".canvas\").addClass(\"removeMode\");$(\".removeModeMessage\").css(\"opacity\",\"1\");$(\".Toolbar\").css({\"pointer-events\":\"none\",\"filter\":\"grayscale(1)\"});}else{$(\".canvas\").removeClass(\"removeMode\");$(\".removeModeMessage\").css(\"opacity\",\"0\");$(\".Toolbar\").css({\"pointer-events\":\"auto\",\"filter\":\"none\"});}},[remove]);// INIT TREE\n// initialise le noeud de debut et le premier critere pour commencer\nfunction initTree(){var startNode=initialTree.entree[0];createNode('input',{x:parseInt(startNode.x),y:parseInt(startNode.y)});var firstNode=initialTree.criteres.find(function(el){return el.ID_Critere===initialTree.entree[0].ID_Critere;});createNode('critereNode',{x:parseInt(firstNode.x),y:parseInt(firstNode.y)},firstNode);createEdge('D0','0',firstNode.ID_Critere,null);var endNode=initialTree.sortie[0];createNode('output',{x:parseInt(endNode.x),y:parseInt(endNode.y)},endNode);initNodes(initialTree.entree[0].ID_Critere);}// initilialise critère, méthodes et décisiosn depuis le premier critère\nfunction initNodes(start){initialTree.criteres.forEach(function(node){var color=colors[0];colors.splice(0,1);if(node.ID_Critere!==start){createNode('critereNode',{x:parseInt(node.x),y:parseInt(node.y)},node);}// on récupère les décisions attaché au critère et on regarde si un méthode est attaché\nvar decisions=getDecisions(node.ID_Critere);decisions.forEach(function(decision){var method=getMethod(decision);if(method){createNode('default',{x:parseInt(method.x),y:parseInt(method.y)},method);createEdge(\"D\"+decision.ID_Decision,node.ID_Critere,\"M\"+method.ID_Methode,decision.Libelle,color);createEdge(\"DM\"+decision.ID_Decision,\"M\"+method.ID_Methode,decision.ID_Critere_sortant,null,color);}else{if(decision.ID_Critere_sortant){createEdge(\"D\"+decision.ID_Decision,decision.ID_Critere_entrant,decision.ID_Critere_sortant,decision.Libelle,color);}else{createEdge(\"D\"+decision.ID_Decision,decision.ID_Critere_entrant,\"S0\",decision.Libelle,color);}}});});}function initEdgesId(){var highest=0;initialTree.decisions.forEach(function(decision){if(parseInt(decision.ID_Decision)>=highest){highest=decision.ID_Decision;}});setNextEdgeId(\"D\"+(parseInt(highest)+1).toString());}// retourne les décisions d'un noeud\nfunction getDecisions(nodeId){var decisions=initialTree.decisions.filter(function(decision){return decision.ID_Critere_entrant===nodeId;});return decisions;}// retourne la méthode d'un décision si elle existe\nfunction getMethod(decision){var method=initialTree.methodes.find(function(method){return method.ID_Decision===decision.ID_Decision;});return method;}// récupère l'arbre a l'initialisation du composant\nuseEffect(function(){if(!initialTree){var protocol=window.location.protocol;var host=window.location.hostname;var url=protocol+'//'+host;axios.get(url+'/API/Controllers/lireArbre.php').then(function(response){setInitialTree(response.data);}).catch(function(error){return console.log(error);});}},[]);// quand l'arbre et chargé et si il possède une entree on lance la création de l'arbre visuel\nuseEffect(function(){if(initialTree){// si l'arbre possède un noeud d'entrée et de sortie on peut le construire\nif(initialTree.entree.length&&initialTree.sortie.length){initTree();initEdgesId();}else{// si ce n'est pas le cas on vérifie si il existe, si il y'a des résidu on prévient qu'il y'a un problème\nif(initialTree.methodes.length||initialTree.criteres.length||initialTree.decisions.length){alert('Something went wrong, tree cannot be built');}}}},[initialTree]);// RECONSTRUCTION DE L'ARBRE\n/*\r\n    types :\r\n        - input (start node)\r\n        - output (end node)\r\n        - default (node)\r\n        - smoothstep (edge)\r\n    */function saveTree(){var flow=reactFlowInstance.toObject();var finalTree={criteres:[],methodes:[],methodesRessources:initialTree.methodesRessources,decisions:[],entree:[],sortie:[]};flow.elements.forEach(function(element){var transformedElement;switch(element.type){case'critereNode':transformedElement=transformToCritere(element);finalTree.criteres.push(transformedElement);break;case'default':transformedElement=transformToMethod(element,flow);finalTree.methodes.push(transformedElement);break;case'smoothstep':if(element.label){transformedElement=transformToDecision(element,flow);finalTree.decisions.push(transformedElement);}break;case'input':transformedElement=transformToEntree(element,flow);finalTree.entree.push(transformedElement);break;case'output':transformedElement=transformToSortie(element);finalTree.sortie.push(transformedElement);break;}});// on regarde si il y'a des erreurs dans l'arbre (cas inaproprié)\nvar error=checkTree(finalTree);if(!error){var protocol=window.location.protocol;var host=window.location.hostname;var url=protocol+'//'+host;axios.post(url+'/API/Controllers/creerArbre.php',finalTree).then(function(response){setModalInformationOpen(true);}).catch(function(error){return console.log(error);});}}/*\r\n        Fonctions de transformation de l'arbre final\r\n    */function transformToCritere(element){var critere={ID_Critere:element.id,Libelle:element.data.label,Informations:element.data.informations?element.data.informations:null,x:element.position.x,y:element.position.y};return critere;}function transformToMethod(element,flow){var decision=flow.elements.find(function(el){return el.type===\"smoothstep\"&&el.target===element.id;});var method={ID_Methode:element.id.slice(1),ID_Decision:decision?decision.id.slice(1):null,Libelle:element.data.label,Description:element.data.description,Donnees_produites:element.data.productedData,Effectif_preconise:element.data.workforce,Exemple:element.data.exemple,Type_analyse:element.data.analysis,Type_methode:element.data.method,x:element.position.x,y:element.position.y};return method;}function transformToDecision(element,flow){var outDecision;if(element.target.includes(\"M\")){outDecision=flow.elements.find(function(el){return el.type===\"smoothstep\"&&el.source===element.target;});}var decision={ID_Decision:element.id.slice(1),ID_Critere_entrant:element.source,ID_Critere_sortant:outDecision?outDecision.target:element.target,Libelle:element.label};return decision;}function transformToEntree(element,flow){var outDecision=flow.elements.find(function(el){return el.type===\"smoothstep\"&&el.source===element.id;});var startNode={ID_Entree:element.id,ID_Critere:outDecision?outDecision.target:null,x:element.position.x,y:element.position.y};return startNode;}function transformToSortie(element){var endNode={ID_Sortie:element.id.slice(1),message:element.data.message,x:element.position.x,y:element.position.y};return endNode;}/*\r\n    l'abre doit :\r\n        - posséder un noeud entree et sortie\r\n        - ne pas posséder d'élements flottant (non relié ou partiellement relié)\r\n        - ne pas posséder d'élements non labellisé excepté les noeud d'entree, sortie,\r\n            liens sortant des méthodes et le lien source du noeud d'entree\r\n    */function checkTree(finalTree){var error=false;// vérifie si il y'a bien un noeud d'entrée et de sortie\nif(finalTree.entree.length!=1){setErrorMessage(\"Tree must have start node\");error=true;}else if(finalTree.sortie.length!=1){setErrorMessage(\"Tree must have end node\");error=true;}else if(!finalTree.criteres.length){setErrorMessage(\"Tree must have node\");error=true;}// si c'est le cas on vérifie si il n'y a pas de noeud flottant\nif(!error){var floatingNode=checkFloatingNode(finalTree);var floatingMethod=checkFloatingMethod(finalTree);if(floatingNode||floatingMethod){error=true;}}return error;}// vérifie si il y'a un noeud flottant\nfunction checkFloatingNode(finalTree){var condition=true;// pour chaque critère on regarde les décisions entrante et sortante\nfinalTree.criteres.forEach(function(critere){var outputEdge=null;var inputEdge=null;outputEdge=finalTree.decisions.filter(function(decision){return decision.ID_Critere_entrant===critere.ID_Critere;});inputEdge=finalTree.decisions.filter(function(decision){return decision.ID_Critere_sortant===critere.ID_Critere;});// on gère le cas ou c'est la décision suivant le noeud d'entrée\nif(!inputEdge.length){if(finalTree.entree[0].ID_Critere===critere.ID_Critere){inputEdge.push(finalTree.entree[0]);}}// si il n'ya pas de noeud sortant ou entrant la condition n'est pas respecté\nif(!inputEdge.length||!outputEdge.length){condition=false;}// si le noeud sortant contient un \"M\" ca veut dire qu'il manque un lien après la méthode\n// la condition n'est pas respecté\noutputEdge.forEach(function(element){if(element.ID_Critere_sortant.charAt(0)===\"M\"){condition=false;}});});// si la condition n'est pas respecté on set un message d'erreur\nif(!condition){setErrorMessage(\"There is a floating node somewhere, check that each edge has a label (except output edge from the start node and methods) and that each critere is connected\");return true;}else{return false;}}// vérifie si il y'a une méthode flottante\nfunction checkFloatingMethod(finalTree){var condition=true;finalTree.methodes.forEach(function(element){if(!element.ID_Decision){condition=false;}else{var decision=finalTree.decisions.find(function(item){return item.ID_Decision===element.ID_Decision;});if(!decision){condition=false;}else{// vérifie qu'un méthode n'est pas conencté au noeud de fin\nif(decision.ID_Critere_sortant==\"S0\"){condition=false;}}}});switch(condition){case true:return false;case false:if(!errorMessage){setErrorMessage(\"There is a floating method somewhere, check that each edge has a label and that each method is connected\");}return true;}}// MODAL MANAGEMENT\n// warning modal\nvar _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),modalWarningOpen=_useState18[0],setModalWarningOpen=_useState18[1];function closeModalWarning(){setErrorMessage(null);setModalWarningOpen(false);}useEffect(function(){if(errorMessage){setModalWarningOpen(true);}},[errorMessage]);// information modal\nvar _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),modalInformationOpen=_useState20[0],setModalInformationOpen=_useState20[1];function closeModalInformation(){setModalInformationOpen(false);}// connfirmation modal\nvar _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),modalConfirmationOpen=_useState22[0],setModalConfirmationOpen=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),messageConfirmation=_useState24[0],setMessageConfirmation=_useState24[1];var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),selectedConfirmationElement=_useState26[0],setSelectedConfirmationElement=_useState26[1];function openModalConfirmation(element){setModalConfirmationOpen(true);setMessageConfirmation(\"Do you want to delete this element ?\");setSelectedConfirmationElement(element);}function closeConfirmationModal(){setModalConfirmationOpen(false);}// edit critères\nvar _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),modalEditCritereOpen=_useState28[0],setModalEditCritereOpen=_useState28[1];var _useState29=useState(null),_useState30=_slicedToArray(_useState29,2),selectedCritere=_useState30[0],setSelectedCritere=_useState30[1];function openModalEditCritere(element){var critere=elements.find(function(el){return el.id===element.id;});setSelectedCritere(critere);setModalEditCritereOpen(true);}function closeModalEditCritere(){setModalEditCritereOpen(false);}function saveCritere(label,informations){// change les data dans l'instance react flow\nselectedCritere.data.label=label;if(informations){selectedCritere.data.informations=informations;}// force le rendu du noeud\n// l'instance ne se rerender pas si modification dans sous object donc on change position\nselectedCritere.position={x:selectedCritere.position.x,y:selectedCritere.position.y+1};rerenderFlow();}// edit edges\nvar _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),modalEditEdgeOpen=_useState32[0],setModalEditEdgeOpen=_useState32[1];var _useState33=useState(null),_useState34=_slicedToArray(_useState33,2),selectedEdge=_useState34[0],setSelectedEdge=_useState34[1];function openModalEditEdge(element){var edge=elements.find(function(el){return el.id===element.id;});setSelectedEdge(edge);setModalEditEdgeOpen(true);}function closeModalEditEdge(){setModalEditEdgeOpen(false);}function saveEdge(label){selectedEdge.label=label;rerenderFlow();}// edit method\nvar _useState35=useState(false),_useState36=_slicedToArray(_useState35,2),modalEditMethodOpen=_useState36[0],setModalEditMethodOpen=_useState36[1];var _useState37=useState(null),_useState38=_slicedToArray(_useState37,2),selectedMethod=_useState38[0],setSelectedMethod=_useState38[1];function openModalEditMethod(element){var method=elements.find(function(el){return el.id===element.id;});setSelectedMethod(method);setModalEditMethodOpen(true);}function closeModalEditMethod(){setModalEditMethodOpen(false);}function saveMethod(newData,newResources){// change les data dans l'instance react flow\nselectedMethod.data.label=newData.label;selectedMethod.data.description=newData.description;selectedMethod.data.productedData=newData.productedData;selectedMethod.data.workforce=newData.workforce;selectedMethod.data.method=newData.method;selectedMethod.data.analysis=newData.analysis;selectedMethod.data.exemple=newData.exemple;// liste des ressources actuellement associé à la méthode\nvar thisMethodResources=initialTree.methodesRessources.filter(function(item){return item.ID_Methode===selectedMethod.id.slice(1);});// associe les ressources qui ne l'etait aps deja a la méthode        \nnewResources.forEach(function(newResource){var resource=thisMethodResources.filter(function(item){return item.ID_Ressource===newResource.ID_Ressource;});if(!resource.length){var newMethodResource={ID_Methode:selectedMethod.id.slice(1),ID_Ressource:newResource.ID_Ressource};initialTree.methodesRessources.push(newMethodResource);}});// supprime les ressources qui ne sont plus associé\ninitialTree.methodesRessources.forEach(function(oldResource){var resource=newResources.filter(function(item){return item.ID_Ressource===oldResource.ID_Ressource;});if(!resource.length){var index=initialTree.methodesRessources.indexOf(oldResource);initialTree.methodesRessources=initialTree.methodesRessources.filter(function(item){return initialTree.methodesRessources.indexOf(item)!==index;});}});// force le rendu du noeud\n// l'instance ne se rerender pas si modification dans sous object donc on change position\nselectedMethod.position={x:selectedMethod.position.x,y:selectedMethod.position.y+1};rerenderFlow();}// edit noeud de fin\nvar _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),modalEditEndNodeOpen=_useState40[0],setModalEditEndNodeOpen=_useState40[1];var _useState41=useState(null),_useState42=_slicedToArray(_useState41,2),selectedEndNode=_useState42[0],setSelectedEndNode=_useState42[1];function openModalEditEndNode(element){var endNode=elements.find(function(el){return el.id===element.id;});setSelectedEndNode(endNode);setModalEditEndNodeOpen(true);}function closeModalEditEndNode(){setModalEditEndNodeOpen(false);}function saveEndNode(message){// change les data dans l'instance react flow\nselectedEndNode.data.message=message;// force le rendu du noeud\n// l'instance ne se rerender pas si modification dans sous object donc on change position\nselectedEndNode.position={x:selectedEndNode.position.x,y:selectedEndNode.position.y+1};rerenderFlow();}// FORCE RERENDER\nfunction rerenderFlow(){var cloneElements=_toConsumableArray(elements);setElements(cloneElements);}return/*#__PURE__*/_jsx(\"div\",{className:\"Tree\",children:elements?/*#__PURE__*/_jsxs(ReactFlowProvider,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"reactflow-wrapper\",ref:reactFlowWrapper,children:[/*#__PURE__*/_jsx(Toolbar,{className:\"tools\",save:saveTree}),/*#__PURE__*/_jsx(\"div\",{className:\"canvas\",children:/*#__PURE__*/_jsx(ReactFlow,{elements:elements,nodeTypes:nodeTypes,onElementsRemove:onElementsRemove,onConnect:onConnect// deleteKeyCode={46}\n,onLoad:setReactFlowInstance,onDrop:onDrop,onDragOver:onDragOver,onElementClick:onElementClick,onPaneClick:onPaneClick})}),/*#__PURE__*/_jsx(FontAwesomeIcon,{onClick:function onClick(){return deleteMode();},className:\"icon delete\",icon:faTrashAlt}),/*#__PURE__*/_jsx(\"p\",{className:\"removeModeMessage\",children:\"Warning, you activated the suppression mode\"})]}),/*#__PURE__*/_jsx(ModalEditCritere,{title:\"Edit critere\",open:modalEditCritereOpen,close:closeModalEditCritere,mainAction:saveCritere,selectedCritere:selectedCritere}),/*#__PURE__*/_jsx(ModalEditEdge,{title:\"Edit Edge\",open:modalEditEdgeOpen,close:closeModalEditEdge,mainAction:saveEdge,selectedEdge:selectedEdge}),/*#__PURE__*/_jsx(ModalEditMethod,{title:\"Edit Method\",open:modalEditMethodOpen,close:closeModalEditMethod,mainAction:saveMethod,selectedMethod:selectedMethod,initialTree:initialTree}),/*#__PURE__*/_jsx(ModalEditEndNode,{title:\"Edit End node\",open:modalEditEndNodeOpen,close:closeModalEditEndNode,mainAction:saveEndNode,selectedEndNode:selectedEndNode}),/*#__PURE__*/_jsx(ModalWarning,{message:errorMessage,open:modalWarningOpen,close:closeModalWarning}),/*#__PURE__*/_jsx(ModalInformation,{open:modalInformationOpen,close:closeModalInformation}),/*#__PURE__*/_jsx(ModalConfirmation,{title:\"Warning\",message:messageConfirmation,open:modalConfirmationOpen,close:closeConfirmationModal,mainAction:deleteElement,mainActionParameters:selectedConfirmationElement,mainActionName:\"Delete\"})]}):/*#__PURE__*/_jsx(Loader,{})});}export default Tree;","map":{"version":3,"sources":["C:/wamp64/www/Projet_TER/src/views/Tree.js"],"names":["React","useRef","useState","useEffect","$","get","axios","ReactFlow","addEdge","ReactFlowProvider","removeElements","FontAwesomeIcon","faTrashAlt","Loader","Toolbar","CustomNode","DebugNode","ModalEditCritere","ModalEditEdge","ModalEditMethod","ModalEditEndNode","ModalWarning","ModalInformation","ModalConfirmation","Tree","nodeTypes","critereNode","debugNode","colors","initialTree","setInitialTree","nextId","setNextId","nextEdgeId","setNextEdgeId","nextMethodId","setNextMethodId","elements","setElements","remove","setRemove","errorMessage","setErrorMessage","reactFlowWrapper","reactFlowInstance","setReactFlowInstance","onElementsRemove","elementsToRemove","els","onConnect","params","id","getEdgeId","arrowHeadType","label","type","parseInt","slice","toString","onDragOver","event","preventDefault","dataTransfer","dropEffect","onDrop","getData","checkExist","alert","reactFlowBounds","current","getBoundingClientRect","toolbarWidth","width","position","project","x","clientX","y","clientY","top","createNode","onElementClick","element","openModalEditCritere","openModalEditMethod","openModalEditEdge","openModalEditEndNode","edges","filter","item","attachedEdges","source","target","length","openModalConfirmation","onPaneClick","getId","getMethodId","data","newNode","message","Message","ID_Critere","Libelle","informations","Informations","ID_Methode","description","Description","productedData","Donnees_produites","workforce","Effectif_preconise","method","Type_methode","analysis","Type_analyse","exemple","Exemple","es","concat","createEdge","id_source","id_target","color","newEdge","style","stroke","i","deleteMode","deleteElement","selectedElement","find","el","index","indexOf","addClass","css","removeClass","initTree","startNode","entree","firstNode","criteres","endNode","sortie","initNodes","start","forEach","node","splice","decisions","getDecisions","decision","getMethod","ID_Decision","ID_Critere_sortant","ID_Critere_entrant","initEdgesId","highest","nodeId","methodes","protocol","window","location","host","hostname","url","then","response","catch","error","console","log","saveTree","flow","toObject","finalTree","methodesRessources","transformedElement","transformToCritere","push","transformToMethod","transformToDecision","transformToEntree","transformToSortie","checkTree","post","setModalInformationOpen","critere","outDecision","includes","ID_Entree","ID_Sortie","floatingNode","checkFloatingNode","floatingMethod","checkFloatingMethod","condition","outputEdge","inputEdge","charAt","modalWarningOpen","setModalWarningOpen","closeModalWarning","modalInformationOpen","closeModalInformation","modalConfirmationOpen","setModalConfirmationOpen","messageConfirmation","setMessageConfirmation","selectedConfirmationElement","setSelectedConfirmationElement","closeConfirmationModal","modalEditCritereOpen","setModalEditCritereOpen","selectedCritere","setSelectedCritere","closeModalEditCritere","saveCritere","rerenderFlow","modalEditEdgeOpen","setModalEditEdgeOpen","selectedEdge","setSelectedEdge","edge","closeModalEditEdge","saveEdge","modalEditMethodOpen","setModalEditMethodOpen","selectedMethod","setSelectedMethod","closeModalEditMethod","saveMethod","newData","newResources","thisMethodResources","newResource","resource","ID_Ressource","newMethodResource","oldResource","modalEditEndNodeOpen","setModalEditEndNodeOpen","selectedEndNode","setSelectedEndNode","closeModalEditEndNode","saveEndNode","cloneElements"],"mappings":"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","sourcesContent":["import React, {useRef, useState, useEffect} from 'react';\r\nimport $, { get } from 'jquery';\r\nimport axios from 'axios';\r\nimport ReactFlow, {addEdge, ReactFlowProvider, removeElements} from 'react-flow-renderer';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faTrashAlt } from '@fortawesome/free-solid-svg-icons';\r\n\r\nimport Loader from '../components/Loader';\r\nimport Toolbar from '../components/Toolbar';\r\nimport CustomNode from '../components/tree/CustomNode';\r\nimport DebugNode from '../components/tree/DebugNode';\r\n\r\nimport ModalEditCritere from '../components/modal/tree/ModalEditCritere';\r\nimport ModalEditEdge from '../components/modal/tree/ModalEditEdge';\r\nimport ModalEditMethod from '../components/modal/tree/ModalEditMethod';\r\nimport ModalEditEndNode from '../components/modal/tree/ModalEditEndNode';\r\nimport ModalWarning from '../components/modal/ModalWarning';\r\nimport ModalInformation from '../components/modal/ModalInformation';\r\nimport ModalConfirmation from '../components/modal/ModalConfirmation';\r\n\r\nfunction Tree() {\r\n    const nodeTypes = {\r\n        critereNode: CustomNode,\r\n        debugNode: DebugNode\r\n    };\r\n\r\n    const colors = ['black', 'marron', 'blue', 'red', 'purple', 'fushia', 'green', 'lime', 'yellow',\r\n'navy', 'aqua', 'aquamarine', 'chocolate', 'coral', 'crimson', 'darkcyan', 'darkgreen', 'darkorange', 'darkseagreen',\r\n'deeppink', 'gold', 'indgo', 'lightcoral'];\r\n\r\n    const [initialTree, setInitialTree] = useState(null);\r\n    // const [resources, setResources] = useState(null);\r\n    const [nextId, setNextId] = useState(\"1\");\r\n    const [nextEdgeId, setNextEdgeId] = useState(\"D1\");\r\n    const [nextMethodId, setNextMethodId] = useState(\"M1\");\r\n    const [elements, setElements] = useState([]);\r\n    const [remove, setRemove] = useState(false);\r\n\r\n    const [errorMessage, setErrorMessage] = useState(null);\r\n\r\n    const reactFlowWrapper = useRef(null);\r\n    const [reactFlowInstance, setReactFlowInstance] = useState(null);\r\n    const onElementsRemove = (elementsToRemove) => setElements((els) => removeElements(elementsToRemove, els));\r\n    const onConnect = (params) => setElements((els) => addEdge({\r\n        ...params,\r\n        id: getEdgeId(), arrowHeadType: 'arrowclosed', label: '', type: 'smoothstep',\r\n    }, els, setNextEdgeId(\"D\" + (parseInt(nextEdgeId.slice(1)) + 1).toString())));\r\n\r\n    // HOOKS REACT-FLOW\r\n\r\n    const onDragOver = (event) => {\r\n        event.preventDefault();\r\n        event.dataTransfer.dropEffect = 'move';\r\n    };\r\n\r\n    const onDrop = (event) => {\r\n        event.preventDefault();\r\n\r\n        //check if input/output already exists\r\n        const type = event.dataTransfer.getData('application/reactflow');\r\n        if (type!= null && type == \"input\" || type == \"output\") {\r\n            if (checkExist(type)) {\r\n                return alert(\"Désolé, il ne peut y avoir qu'un seul noeud de type \" + type)\r\n            }\r\n        }\r\n\r\n        const reactFlowBounds = reactFlowWrapper.current.getBoundingClientRect();\r\n        let toolbarWidth = $('aside').width();\r\n        const position = reactFlowInstance.project({\r\n            x: event.clientX - toolbarWidth,\r\n            y: event.clientY - reactFlowBounds.top,\r\n        });\r\n        createNode(type, position);\r\n    };\r\n\r\n    const onElementClick = (event, element) => {\r\n        if(!remove){\r\n            switch (element.type) {\r\n                case 'critereNode':\r\n                    openModalEditCritere(element);\r\n                    break;\r\n                case 'default':\r\n                    openModalEditMethod(element);\r\n                    break;\r\n                case 'smoothstep':\r\n                    openModalEditEdge(element);\r\n                    break;\r\n                case 'input':\r\n                    alert(\"Cannot modify start node\")\r\n                    break;\r\n                case 'output':\r\n                    openModalEditEndNode(element);\r\n                    break;\r\n            }\r\n        } else {\r\n            if(element.type != \"smoothstep\"){\r\n                let edges = elements.filter(item => item.type === \"smoothstep\");\r\n                let attachedEdges = edges.filter(item => item.source === element.id || item.target === element.id );\r\n                if(attachedEdges.length > 0){\r\n                    alert(\"You must remove all edges from this element\")\r\n                } else {\r\n                    openModalConfirmation(element)\r\n                    // deleteElement(element); \r\n                }\r\n            } else {\r\n                openModalConfirmation(element)\r\n                // deleteElement(element); \r\n            }\r\n        }\r\n    }\r\n\r\n    const onPaneClick = (event) => {\r\n        event.preventDefault();\r\n    }\r\n\r\n\r\n    // FUNCTIONS\r\n\r\n    // return les prochains ID utilisable\r\n    function getId() {\r\n        return nextId;\r\n    }\r\n\r\n    function getEdgeId() {\r\n        return nextEdgeId;\r\n    }\r\n\r\n    function getMethodId() {\r\n        return nextMethodId;\r\n    }\r\n\r\n    /*\r\n    crée un noeud de type :\r\n        - input\r\n        - output\r\n        - default (method)\r\n        - critereNode (critere)\r\n\r\n    parametres :\r\n        - type : type du noeud\r\n        - position : position du client si noeud créer via toolbar ou position x et y stocké en bd\r\n        - data : toutes les data du noeud de la BD, si noeud créer via toolbar le label et générer par défault\r\n    */\r\n    function createNode(type, position, data) {\r\n        let newNode;\r\n        switch (type) {\r\n            case 'input':\r\n                // noeud entree\r\n                newNode = {\r\n                    id: \"0\",\r\n                    type,\r\n                    position,\r\n                    data: {label: `${type} node`},\r\n                };\r\n                break;\r\n            case 'output':\r\n                // noeud sortie\r\n                newNode = {\r\n                    id: \"S0\",\r\n                    type,\r\n                    position,\r\n                    data: {\r\n                        label: `${type} node`,\r\n                        message: (data ? data.Message : null)\r\n                    },\r\n                };\r\n                break;\r\n            case 'critereNode':\r\n                // noeud critere\r\n                if(data){\r\n                    newNode = {\r\n                        id: data.ID_Critere,\r\n                        type,\r\n                        position,\r\n                        data: {\r\n                            label: data.Libelle,\r\n                            informations: (data.Informations ? data.Informations : null)\r\n                        },\r\n                    };\r\n                    if(data.ID_Critere >= getId()){\r\n                        setNextId((parseInt(data.ID_Critere) + 1).toString());\r\n                    }      \r\n                } else {\r\n                    newNode = {\r\n                        id: getId(),\r\n                        type,\r\n                        position,\r\n                        data: {label: \"default critere label\"},\r\n                    };\r\n                    setNextId((parseInt(nextId) + 1).toString());\r\n                }\r\n                break;\r\n            case 'default':\r\n                // noeud methode\r\n                if(data){\r\n                    newNode = {\r\n                        id: \"M\" + data.ID_Methode,\r\n                        type,\r\n                        position,\r\n                        data: {\r\n                            label: data.Libelle,\r\n                            description: data.Description,\r\n                            productedData: data.Donnees_produites,\r\n                            workforce: data.Effectif_preconise,\r\n                            method: data.Type_methode,\r\n                            analysis: data.Type_analyse,\r\n                            exemple: data.Exemple\r\n                        },\r\n                    };\r\n                    if(parseInt(data.ID_Methode) >= getMethodId().slice(1)){\r\n                        setNextMethodId(\"M\" + (parseInt(data.ID_Methode) + 1).toString());\r\n                    }               \r\n                } else {\r\n                    newNode = {\r\n                        id: getMethodId(),\r\n                        type,\r\n                        position,\r\n                        data: {label: \"default method label\"},\r\n                    };\r\n                    setNextMethodId(\"M\" + (parseInt(getMethodId().slice(1)) + 1).toString());\r\n                }\r\n                break;\r\n        }\r\n        // insertion du noeud dans les elements react flow render\r\n        setElements((es) => es.concat(newNode));\r\n    }\r\n    \r\n    // crée un lien entre 2 noeuds\r\n    function createEdge(id, id_source, id_target, label, color){\r\n        let newEdge = {\r\n            id: id,\r\n            source: id_source,\r\n            target: id_target,\r\n            type: 'smoothstep',\r\n            arrowHeadType: 'arrowclosed',\r\n            label: label,\r\n            style: { stroke: color },\r\n        }\r\n        setElements((es) => es.concat(newEdge));\r\n    }\r\n\r\n    // check if a node type already exists\r\n    function checkExist(type) {\r\n        if(elements){\r\n            for (let i = 0; i < elements.length; i++) {\r\n                if (elements[i].type == type) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    // gestion de la supression\r\n    function deleteMode(){\r\n        remove ? setRemove(false) : setRemove(true);\r\n    }\r\n\r\n    function deleteElement(element){\r\n            let selectedElement = elements.find(el => el.id === element.id);\r\n            let index = elements.indexOf(selectedElement);\r\n            setElements(elements.filter(item => elements.indexOf(item) !== index))\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(remove){\r\n            $(\".canvas\").addClass( \"removeMode\" );\r\n            $(\".removeModeMessage\").css(\"opacity\", \"1\");\r\n            $(\".Toolbar\").css({\"pointer-events\": \"none\", \"filter\" : \"grayscale(1)\"});\r\n        } else {\r\n            $(\".canvas\").removeClass( \"removeMode\" );\r\n            $(\".removeModeMessage\").css(\"opacity\", \"0\");\r\n            $(\".Toolbar\").css({\"pointer-events\": \"auto\", \"filter\" : \"none\"});\r\n        }\r\n    },[remove]);\r\n\r\n    // INIT TREE\r\n\r\n    // initialise le noeud de debut et le premier critere pour commencer\r\n    function initTree(){\r\n        let startNode = initialTree.entree[0];\r\n        createNode('input', {x: parseInt(startNode.x), y: parseInt(startNode.y)});\r\n        let firstNode = initialTree.criteres.find(el => el.ID_Critere === initialTree.entree[0].ID_Critere);\r\n        createNode('critereNode', {x: parseInt(firstNode.x), y: parseInt(firstNode.y)}, firstNode);\r\n        createEdge('D0' ,'0', firstNode.ID_Critere, null);\r\n\r\n        let endNode = initialTree.sortie[0];\r\n        createNode('output',  {x: parseInt(endNode.x), y: parseInt(endNode.y)}, endNode);\r\n\r\n        initNodes(initialTree.entree[0].ID_Critere);\r\n    }\r\n\r\n    // initilialise critère, méthodes et décisiosn depuis le premier critère\r\n    function initNodes(start){\r\n        initialTree.criteres.forEach(node => {\r\n            let color = colors[0]\r\n            colors.splice(0, 1);\r\n            if(node.ID_Critere !== start){\r\n                createNode('critereNode',  {x: parseInt(node.x), y: parseInt(node.y)}, node)\r\n            }\r\n            // on récupère les décisions attaché au critère et on regarde si un méthode est attaché\r\n            let decisions = getDecisions(node.ID_Critere);\r\n            decisions.forEach(decision => {\r\n                let method = getMethod(decision);\r\n                if(method){\r\n                    createNode('default',  {x: parseInt(method.x), y: parseInt(method.y)}, method);\r\n                    createEdge(\"D\" + decision.ID_Decision ,node.ID_Critere, \"M\" + method.ID_Methode, decision.Libelle, color);\r\n                    createEdge(\"DM\" + decision.ID_Decision, \"M\" + method.ID_Methode, decision.ID_Critere_sortant, null, color);\r\n                } else {\r\n                    if(decision.ID_Critere_sortant){\r\n                        createEdge(\"D\" + decision.ID_Decision, decision.ID_Critere_entrant, decision.ID_Critere_sortant, decision.Libelle, color);\r\n                    } else {\r\n                        createEdge(\"D\" + decision.ID_Decision, decision.ID_Critere_entrant, \"S0\", decision.Libelle, color);\r\n                    }\r\n                }\r\n            })                \r\n        });\r\n    }\r\n\r\n    function initEdgesId(){\r\n        let highest = 0;\r\n        initialTree.decisions.forEach(decision => {\r\n            if(parseInt(decision.ID_Decision) >= highest){\r\n                highest = decision.ID_Decision;\r\n            }\r\n        })\r\n        setNextEdgeId(\"D\" + (parseInt(highest) + 1).toString());\r\n    }\r\n\r\n    // retourne les décisions d'un noeud\r\n    function getDecisions(nodeId){\r\n        let decisions =  initialTree.decisions.filter(decision => decision.ID_Critere_entrant === nodeId);\r\n        return decisions;\r\n    }\r\n\r\n    // retourne la méthode d'un décision si elle existe\r\n    function getMethod(decision){\r\n        let method =  initialTree.methodes.find(method => method.ID_Decision === decision.ID_Decision);\r\n        return method;\r\n    }\r\n\r\n    // récupère l'arbre a l'initialisation du composant\r\n    useEffect(() => {\r\n        if(!initialTree){\r\n            let protocol = window.location.protocol;\r\n            let host = window.location.hostname;\r\n            let url = protocol + '//' + host;\r\n                axios.get(url + '/API/Controllers/lireArbre.php')\r\n                .then(response => {\r\n                    setInitialTree(response.data)\r\n                })\r\n                .catch(error => console.log(error))\r\n        }\r\n    },[]);\r\n\r\n    // quand l'arbre et chargé et si il possède une entree on lance la création de l'arbre visuel\r\n    useEffect(() => {\r\n        if(initialTree){\r\n            // si l'arbre possède un noeud d'entrée et de sortie on peut le construire\r\n            if(initialTree.entree.length && initialTree.sortie.length){\r\n                initTree();\r\n                initEdgesId();\r\n            }else{\r\n                // si ce n'est pas le cas on vérifie si il existe, si il y'a des résidu on prévient qu'il y'a un problème\r\n                if(initialTree.methodes.length || initialTree.criteres.length || initialTree.decisions.length){\r\n                    alert('Something went wrong, tree cannot be built');\r\n                }\r\n            }\r\n        } \r\n    }, [initialTree]);\r\n\r\n    // RECONSTRUCTION DE L'ARBRE\r\n\r\n    /*\r\n    types :\r\n        - input (start node)\r\n        - output (end node)\r\n        - default (node)\r\n        - smoothstep (edge)\r\n    */\r\n    function saveTree() {\r\n        let flow = reactFlowInstance.toObject();\r\n        let finalTree = {\r\n            criteres: [],\r\n            methodes: [],\r\n            methodesRessources: initialTree.methodesRessources,\r\n            decisions: [],\r\n            entree: [],\r\n            sortie: [],\r\n        };\r\n        flow.elements.forEach(element => {\r\n            let transformedElement;\r\n            switch (element.type) {\r\n                case 'critereNode':\r\n                    transformedElement = transformToCritere(element);\r\n                    finalTree.criteres.push(transformedElement)\r\n                    break;\r\n                case 'default':\r\n                    transformedElement = transformToMethod(element, flow);\r\n                    finalTree.methodes.push(transformedElement)\r\n                    break;\r\n                case 'smoothstep':\r\n                    if(element.label){\r\n                        transformedElement = transformToDecision(element, flow);\r\n                        finalTree.decisions.push(transformedElement)\r\n                    }\r\n                        break;\r\n                case 'input':\r\n                    transformedElement = transformToEntree(element,flow);\r\n                    finalTree.entree.push(transformedElement)\r\n                    break;\r\n                case 'output':\r\n                    transformedElement = transformToSortie(element);\r\n                    finalTree.sortie.push(transformedElement)\r\n                    break;\r\n            }\r\n        })\r\n        \r\n        // on regarde si il y'a des erreurs dans l'arbre (cas inaproprié)\r\n        let error = checkTree(finalTree);\r\n        if(!error){\r\n            let protocol = window.location.protocol;\r\n            let host = window.location.hostname;\r\n            let url = protocol + '//' + host;\r\n                axios.post(url + '/API/Controllers/creerArbre.php', finalTree)\r\n                .then(response => {\r\n                    setModalInformationOpen(true);\r\n                })\r\n                .catch(error => console.log(error))\r\n        }\r\n    }\r\n\r\n    /*\r\n        Fonctions de transformation de l'arbre final\r\n    */\r\n    function transformToCritere(element){\r\n        let critere = {\r\n            ID_Critere: element.id,\r\n            Libelle: element.data.label,\r\n            Informations: (element.data.informations ? element.data.informations : null),\r\n            x: element.position.x,\r\n            y: element.position.y\r\n        }\r\n        return critere;\r\n    }\r\n\r\n    function transformToMethod(element, flow){\r\n        let decision = flow.elements.find(el => el.type === \"smoothstep\" && el.target === element.id);\r\n        let method = {\r\n            ID_Methode: element.id.slice(1),\r\n            ID_Decision: (decision ? decision.id.slice(1) : null),\r\n            Libelle: element.data.label,\r\n            Description: element.data.description,\r\n            Donnees_produites: element.data.productedData,\r\n            Effectif_preconise: element.data.workforce,\r\n            Exemple: element.data.exemple,\r\n            Type_analyse: element.data.analysis,\r\n            Type_methode: element.data.method,\r\n            x: element.position.x,\r\n            y: element.position.y\r\n        }\r\n        return method;\r\n    }\r\n\r\n    function transformToDecision(element, flow){\r\n        let outDecision;\r\n        if(element.target.includes(\"M\")){\r\n            outDecision = flow.elements.find(el => el.type === \"smoothstep\" && el.source === element.target);\r\n        }\r\n\r\n        let decision = {\r\n            ID_Decision: element.id.slice(1),\r\n            ID_Critere_entrant: element.source,\r\n            ID_Critere_sortant: (outDecision ? outDecision.target : element.target),\r\n            Libelle: element.label,\r\n        }\r\n        return decision;\r\n    }\r\n\r\n    function transformToEntree(element, flow){\r\n        let outDecision = flow.elements.find(el => el.type === \"smoothstep\" && el.source === element.id);\r\n        let startNode = {\r\n            ID_Entree: element.id,\r\n            ID_Critere: (outDecision ? outDecision.target : null),\r\n            x: element.position.x,\r\n            y: element.position.y\r\n        }\r\n        return startNode;\r\n    }\r\n\r\n    function transformToSortie(element){\r\n        let endNode = {\r\n            ID_Sortie: element.id.slice(1),\r\n            message: element.data.message,\r\n            x: element.position.x,\r\n            y: element.position.y\r\n        }\r\n        return endNode;\r\n    }\r\n\r\n    /*\r\n    l'abre doit :\r\n        - posséder un noeud entree et sortie\r\n        - ne pas posséder d'élements flottant (non relié ou partiellement relié)\r\n        - ne pas posséder d'élements non labellisé excepté les noeud d'entree, sortie,\r\n            liens sortant des méthodes et le lien source du noeud d'entree\r\n    */\r\n    function checkTree(finalTree){\r\n        let error = false;\r\n        // vérifie si il y'a bien un noeud d'entrée et de sortie\r\n        if(finalTree.entree.length != 1){\r\n            setErrorMessage(\"Tree must have start node\");\r\n            error = true;\r\n        } else if (finalTree.sortie.length != 1){\r\n            setErrorMessage(\"Tree must have end node\");\r\n            error = true;\r\n        } else if (!finalTree.criteres.length){\r\n            setErrorMessage(\"Tree must have node\");\r\n            error = true;\r\n        } \r\n\r\n        // si c'est le cas on vérifie si il n'y a pas de noeud flottant\r\n        if(!error){\r\n            let floatingNode = checkFloatingNode(finalTree);\r\n            let floatingMethod = checkFloatingMethod(finalTree);\r\n            if(floatingNode || floatingMethod){\r\n                error = true;\r\n            }\r\n        }\r\n        \r\n        return error;\r\n    }\r\n\r\n    // vérifie si il y'a un noeud flottant\r\n    function checkFloatingNode(finalTree){\r\n        let condition = true;\r\n\r\n        // pour chaque critère on regarde les décisions entrante et sortante\r\n        finalTree.criteres.forEach(critere => {\r\n            let outputEdge = null;\r\n            let inputEdge = null;\r\n            outputEdge = finalTree.decisions.filter(decision => decision.ID_Critere_entrant === critere.ID_Critere);\r\n            inputEdge = finalTree.decisions.filter(decision => decision.ID_Critere_sortant === critere.ID_Critere);\r\n\r\n            // on gère le cas ou c'est la décision suivant le noeud d'entrée\r\n            if(!inputEdge.length){\r\n                if(finalTree.entree[0].ID_Critere === critere.ID_Critere){\r\n                    inputEdge.push(finalTree.entree[0]);\r\n                }\r\n            }\r\n\r\n            // si il n'ya pas de noeud sortant ou entrant la condition n'est pas respecté\r\n            if(!inputEdge.length || !outputEdge.length){\r\n                condition = false;\r\n            }\r\n\r\n            // si le noeud sortant contient un \"M\" ca veut dire qu'il manque un lien après la méthode\r\n            // la condition n'est pas respecté\r\n            outputEdge.forEach(element =>{\r\n                if(element.ID_Critere_sortant.charAt(0) === \"M\"){\r\n                    condition = false;\r\n                }\r\n            })\r\n        })\r\n        // si la condition n'est pas respecté on set un message d'erreur\r\n        if(!condition){\r\n            setErrorMessage(\"There is a floating node somewhere, check that each edge has a label (except output edge from the start node and methods) and that each critere is connected\");\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // vérifie si il y'a une méthode flottante\r\n    function checkFloatingMethod(finalTree){\r\n        let condition = true;\r\n\r\n        finalTree.methodes.forEach(element => {\r\n            if(!element.ID_Decision){\r\n                condition = false;\r\n            } else {\r\n                let decision = finalTree.decisions.find(item => item.ID_Decision === element.ID_Decision);\r\n                if(!decision){\r\n                    condition = false;\r\n                } else {\r\n                    // vérifie qu'un méthode n'est pas conencté au noeud de fin\r\n                    if(decision.ID_Critere_sortant == \"S0\"){\r\n                        condition = false;\r\n                    }\r\n                }\r\n            }\r\n        })\r\n\r\n        switch(condition){\r\n            case true:\r\n                return false;\r\n            case false:\r\n                if(!errorMessage){\r\n                    setErrorMessage(\"There is a floating method somewhere, check that each edge has a label and that each method is connected\");\r\n                }\r\n                return true;\r\n        }\r\n    }\r\n    \r\n    // MODAL MANAGEMENT\r\n\r\n    // warning modal\r\n\r\n    const [modalWarningOpen, setModalWarningOpen] = useState(false);\r\n\r\n    function closeModalWarning(){\r\n        setErrorMessage(null);\r\n        setModalWarningOpen(false);\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(errorMessage){\r\n            setModalWarningOpen(true);\r\n        }\r\n    }, [errorMessage]);\r\n\r\n    // information modal\r\n\r\n    const [modalInformationOpen, setModalInformationOpen] = useState(false);\r\n\r\n    function closeModalInformation(){\r\n        setModalInformationOpen(false);\r\n    }\r\n\r\n    // connfirmation modal\r\n    const [modalConfirmationOpen, setModalConfirmationOpen] = useState(false);\r\n    const [messageConfirmation, setMessageConfirmation] = useState(null);\r\n    const [selectedConfirmationElement, setSelectedConfirmationElement] = useState(null);\r\n\r\n    function openModalConfirmation(element) {\r\n        setModalConfirmationOpen(true);\r\n        setMessageConfirmation(\"Do you want to delete this element ?\")\r\n        setSelectedConfirmationElement(element)\r\n    }\r\n\r\n    function closeConfirmationModal(){\r\n        setModalConfirmationOpen(false);\r\n    }\r\n\r\n    // edit critères\r\n\r\n    const [modalEditCritereOpen, setModalEditCritereOpen] = useState(false);\r\n    const [selectedCritere, setSelectedCritere] = useState(null);\r\n\r\n    function openModalEditCritere(element) {\r\n        let critere = elements.find(el => el.id === element.id);\r\n        setSelectedCritere(critere);\r\n        setModalEditCritereOpen(true);\r\n    }\r\n\r\n    function closeModalEditCritere(){\r\n        setModalEditCritereOpen(false);\r\n    }\r\n\r\n    function saveCritere(label, informations){\r\n        // change les data dans l'instance react flow\r\n        selectedCritere.data.label = label;\r\n        if(informations){selectedCritere.data.informations = informations;}\r\n\r\n        // force le rendu du noeud\r\n        // l'instance ne se rerender pas si modification dans sous object donc on change position\r\n        selectedCritere.position = {x: selectedCritere.position.x, y: selectedCritere.position.y + 1}\r\n        rerenderFlow();\r\n    }\r\n\r\n    // edit edges\r\n    const [modalEditEdgeOpen, setModalEditEdgeOpen] = useState(false);\r\n    const [selectedEdge, setSelectedEdge] = useState(null);\r\n\r\n    function openModalEditEdge(element) {\r\n        let edge = elements.find(el => el.id === element.id);\r\n        setSelectedEdge(edge);\r\n        setModalEditEdgeOpen(true);\r\n    }\r\n\r\n    function closeModalEditEdge(){\r\n        setModalEditEdgeOpen(false);\r\n    }\r\n\r\n    function saveEdge(label){\r\n        selectedEdge.label = label;\r\n        rerenderFlow();\r\n    }\r\n\r\n    // edit method\r\n\r\n    const [modalEditMethodOpen, setModalEditMethodOpen] = useState(false);\r\n    const [selectedMethod, setSelectedMethod] = useState(null);\r\n\r\n    function openModalEditMethod(element) {\r\n        let method = elements.find(el => el.id === element.id);\r\n        setSelectedMethod(method);\r\n        setModalEditMethodOpen(true);\r\n    }\r\n\r\n    function closeModalEditMethod(){\r\n        setModalEditMethodOpen(false);\r\n    }\r\n\r\n    function saveMethod(newData, newResources){\r\n        // change les data dans l'instance react flow\r\n        selectedMethod.data.label = newData.label;\r\n        selectedMethod.data.description = newData.description;\r\n        selectedMethod.data.productedData = newData.productedData;\r\n        selectedMethod.data.workforce = newData.workforce;\r\n        selectedMethod.data.method = newData.method;\r\n        selectedMethod.data.analysis = newData.analysis;\r\n        selectedMethod.data.exemple = newData.exemple;\r\n\r\n        // liste des ressources actuellement associé à la méthode\r\n        let thisMethodResources = initialTree.methodesRessources.filter(item => item.ID_Methode === selectedMethod.id.slice(1));\r\n\r\n        // associe les ressources qui ne l'etait aps deja a la méthode        \r\n        newResources.forEach(newResource => {\r\n            let resource = thisMethodResources.filter(item => item.ID_Ressource === newResource.ID_Ressource);\r\n            if(!resource.length){\r\n                let newMethodResource = {\r\n                    ID_Methode: selectedMethod.id.slice(1),\r\n                    ID_Ressource: newResource.ID_Ressource\r\n                }\r\n                initialTree.methodesRessources.push(newMethodResource);\r\n            }\r\n        })\r\n\r\n        // supprime les ressources qui ne sont plus associé\r\n        initialTree.methodesRessources.forEach(oldResource => {\r\n            let resource = newResources.filter(item => item.ID_Ressource === oldResource.ID_Ressource);\r\n            if(!resource.length){\r\n                let index =  initialTree.methodesRessources.indexOf(oldResource);\r\n                initialTree.methodesRessources = initialTree.methodesRessources.filter(item => initialTree.methodesRessources.indexOf(item) !== index);\r\n            }   \r\n        })\r\n\r\n        // force le rendu du noeud\r\n        // l'instance ne se rerender pas si modification dans sous object donc on change position\r\n        selectedMethod.position = {x: selectedMethod.position.x, y: selectedMethod.position.y + 1}\r\n        rerenderFlow();\r\n    }\r\n\r\n    // edit noeud de fin\r\n\r\n    const [modalEditEndNodeOpen, setModalEditEndNodeOpen] = useState(false);\r\n    const [selectedEndNode, setSelectedEndNode] = useState(null);\r\n\r\n    function openModalEditEndNode(element) {\r\n        let endNode = elements.find(el => el.id === element.id);\r\n        setSelectedEndNode(endNode);\r\n        setModalEditEndNodeOpen(true);\r\n    }\r\n\r\n    function closeModalEditEndNode(){\r\n        setModalEditEndNodeOpen(false);\r\n    }\r\n\r\n    function saveEndNode(message){\r\n        // change les data dans l'instance react flow\r\n        selectedEndNode.data.message = message;\r\n\r\n        // force le rendu du noeud\r\n        // l'instance ne se rerender pas si modification dans sous object donc on change position\r\n        selectedEndNode.position = {x: selectedEndNode.position.x, y: selectedEndNode.position.y + 1}\r\n        rerenderFlow();\r\n    }\r\n\r\n    // FORCE RERENDER\r\n\r\n    function rerenderFlow(){\r\n        let cloneElements = [...elements];\r\n        setElements(cloneElements);     \r\n    }\r\n\r\n    return (\r\n        <div className=\"Tree\">\r\n            {elements ?\r\n                <ReactFlowProvider>\r\n                    <div className=\"reactflow-wrapper\" ref={reactFlowWrapper}>\r\n                        <Toolbar className=\"tools\"\r\n                            save={saveTree}\r\n                        />\r\n                        <div className=\"canvas\">\r\n                            <ReactFlow\r\n                                elements={elements}\r\n                                nodeTypes={nodeTypes}\r\n                                onElementsRemove={onElementsRemove}\r\n                                onConnect={onConnect}\r\n                                // deleteKeyCode={46}\r\n                                onLoad={setReactFlowInstance}\r\n                                onDrop={onDrop}\r\n                                onDragOver={onDragOver}\r\n                                onElementClick={onElementClick}\r\n                                onPaneClick={onPaneClick}/>\r\n                        </div>\r\n                        <FontAwesomeIcon onClick={() => deleteMode()} className=\"icon delete\" icon={faTrashAlt} />\r\n                        <p className=\"removeModeMessage\">Warning, you activated the suppression mode</p>\r\n                    </div>\r\n                    {/*<button onClick={() => console.log(nextEdgeId)}>debug</button>*/}\r\n\r\n                    <ModalEditCritere\r\n                        title=\"Edit critere\"\r\n                        open={modalEditCritereOpen}  \r\n                        close={closeModalEditCritere}\r\n                        mainAction={saveCritere}\r\n                        selectedCritere={selectedCritere}\r\n                    />\r\n\r\n                    <ModalEditEdge\r\n                        title=\"Edit Edge\"\r\n                        open={modalEditEdgeOpen}  \r\n                        close={closeModalEditEdge}\r\n                        mainAction={saveEdge}\r\n                        selectedEdge={selectedEdge}\r\n                    />\r\n\r\n                    <ModalEditMethod\r\n                        title=\"Edit Method\"\r\n                        open={modalEditMethodOpen}  \r\n                        close={closeModalEditMethod}\r\n                        mainAction={saveMethod}\r\n                        selectedMethod={selectedMethod}\r\n                        initialTree={initialTree}\r\n                    />\r\n\r\n                    <ModalEditEndNode\r\n                        title=\"Edit End node\"\r\n                        open={modalEditEndNodeOpen}  \r\n                        close={closeModalEditEndNode}\r\n                        mainAction={saveEndNode}\r\n                        selectedEndNode={selectedEndNode}\r\n                    />\r\n\r\n                    <ModalWarning\r\n                        message={errorMessage}\r\n                        open={modalWarningOpen}  \r\n                        close={closeModalWarning}\r\n                    />\r\n\r\n                    <ModalInformation\r\n                        open={modalInformationOpen}  \r\n                        close={closeModalInformation}\r\n                    />\r\n\r\n                    <ModalConfirmation\r\n                        title=\"Warning\"\r\n                        message={messageConfirmation}\r\n                        open={modalConfirmationOpen}  \r\n                        close={closeConfirmationModal}\r\n                        mainAction={deleteElement}\r\n                        mainActionParameters={selectedConfirmationElement}\r\n                        mainActionName=\"Delete\"\r\n                    />\r\n                </ReactFlowProvider>\r\n            : <Loader/> \r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Tree;\r\n"]},"metadata":{},"sourceType":"module"}