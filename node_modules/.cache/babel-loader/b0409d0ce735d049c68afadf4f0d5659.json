{"ast":null,"code":"import axios from 'axios';\nimport jwt_decode from \"jwt-decode\";\nimport { addItem, getItem, removeItem } from \"./LocalStorage\";\nexport function hasAuthenticated() {\n  const token = getItem('token');\n  const result = token ? tokenIsValid(token) : false;\n  console.log(result);\n\n  if (false === result) {\n    removeItem('token');\n  }\n\n  return result;\n}\nexport function testRole() {\n  const token = getItem('token');\n  const result = token ? tokenIsValid(token) : false;\n  console.log(result);\n\n  if (false === result) {\n    removeItem('token');\n  }\n\n  if (true === result) {\n    getRole(token);\n  }\n\n  return result;\n}\nexport function getRole(token) {\n  const tokenResult = decodeToken(token);\n  return tokenResult['user_role'];\n}\nexport function login(credentials) {\n  let protocol = window.location.protocol;\n  let host = window.location.hostname;\n  let url = protocol + '//' + host;\n  return axios.post(url + '/Projet_TER/API/Controllers/connexion.php', credentials).then(response => response.data.token).then(token => {\n    addItem('token', token);\n    return true;\n  });\n}\nexport function logout() {\n  removeItem('token');\n}\n\nfunction tokenIsValid(token) {\n  const decoded = jwt_decode(token);\n  const exp = decoded['exp'];\n  console.log(exp);\n  return exp * 1000 > new Date().getTime();\n}\n\nfunction decodeToken(token) {\n  return jwt_decode(token);\n}","map":{"version":3,"sources":["C:/wamp64/www/Projet_TER/src/services/AuthApi.js"],"names":["axios","jwt_decode","addItem","getItem","removeItem","hasAuthenticated","token","result","tokenIsValid","console","log","testRole","getRole","tokenResult","decodeToken","login","credentials","protocol","window","location","host","hostname","url","post","then","response","data","logout","decoded","exp","Date","getTime"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,SAAQC,OAAR,EAAiBC,OAAjB,EAA0BC,UAA1B,QAA2C,gBAA3C;AAEA,OAAO,SAASC,gBAAT,GAA4B;AAE/B,QAAMC,KAAK,GAAGH,OAAO,CAAC,OAAD,CAArB;AACA,QAAMI,MAAM,GAAGD,KAAK,GAAGE,YAAY,CAACF,KAAD,CAAf,GAAyB,KAA7C;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAYH,MAAZ;;AACA,MAAI,UAAUA,MAAd,EAAsB;AAClBH,IAAAA,UAAU,CAAC,OAAD,CAAV;AACH;;AACD,SAAOG,MAAP;AACH;AAID,OAAO,SAASI,QAAT,GAAmB;AACtB,QAAML,KAAK,GAAGH,OAAO,CAAC,OAAD,CAArB;AACA,QAAMI,MAAM,GAAGD,KAAK,GAAGE,YAAY,CAACF,KAAD,CAAf,GAAyB,KAA7C;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAYH,MAAZ;;AACA,MAAI,UAAUA,MAAd,EAAsB;AAClBH,IAAAA,UAAU,CAAC,OAAD,CAAV;AACH;;AACD,MAAG,SAASG,MAAZ,EAAoB;AAChBK,IAAAA,OAAO,CAACN,KAAD,CAAP;AACH;;AACD,SAAOC,MAAP;AACH;AAED,OAAO,SAASK,OAAT,CAAiBN,KAAjB,EAAuB;AAC1B,QAAMO,WAAW,GAAGC,WAAW,CAACR,KAAD,CAA/B;AACA,SAAOO,WAAW,CAAC,WAAD,CAAlB;AACH;AAED,OAAO,SAASE,KAAT,CAAeC,WAAf,EAA4B;AAC/B,MAAIC,QAAQ,GAAGC,MAAM,CAACC,QAAP,CAAgBF,QAA/B;AACA,MAAIG,IAAI,GAAGF,MAAM,CAACC,QAAP,CAAgBE,QAA3B;AACA,MAAIC,GAAG,GAAGL,QAAQ,GAAG,IAAX,GAAkBG,IAA5B;AACA,SAAOpB,KAAK,CACPuB,IADE,CACGD,GAAG,GAAG,2CADT,EACsDN,WADtD,EAEFQ,IAFE,CAEGC,QAAQ,IAAIA,QAAQ,CAACC,IAAT,CAAcpB,KAF7B,EAGFkB,IAHE,CAGGlB,KAAK,IAAI;AACXJ,IAAAA,OAAO,CAAC,OAAD,EAAUI,KAAV,CAAP;AACA,WAAO,IAAP;AACH,GANE,CAAP;AAOH;AAED,OAAO,SAASqB,MAAT,GAAkB;AACrBvB,EAAAA,UAAU,CAAC,OAAD,CAAV;AACH;;AAED,SAASI,YAAT,CAAsBF,KAAtB,EAA6B;AACzB,QAAMsB,OAAO,GAAG3B,UAAU,CAACK,KAAD,CAA1B;AACA,QAAMuB,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAnB;AACAnB,EAAAA,OAAO,CAACC,GAAR,CAAYmB,GAAZ;AACA,SAAOA,GAAG,GAAG,IAAN,GAAa,IAAIC,IAAJ,GAAWC,OAAX,EAApB;AACH;;AAED,SAASjB,WAAT,CAAqBR,KAArB,EAA2B;AACvB,SAAOL,UAAU,CAACK,KAAD,CAAjB;AACH","sourcesContent":["import axios from 'axios';\r\nimport jwt_decode from \"jwt-decode\";\r\nimport {addItem, getItem, removeItem} from \"./LocalStorage\";\r\n\r\nexport function hasAuthenticated() {\r\n\r\n    const token = getItem('token');\r\n    const result = token ? tokenIsValid(token) : false;\r\n    console.log(result);\r\n    if (false === result) {\r\n        removeItem('token');\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\n\r\nexport function testRole(){\r\n    const token = getItem('token');\r\n    const result = token ? tokenIsValid(token) : false;\r\n    console.log(result);\r\n    if (false === result) {\r\n        removeItem('token');\r\n    }\r\n    if(true === result) {\r\n        getRole(token);\r\n    }\r\n    return result;\r\n}\r\n\r\nexport function getRole(token){\r\n    const tokenResult = decodeToken(token);\r\n    return tokenResult['user_role'];\r\n}\r\n\r\nexport function login(credentials) {\r\n    let protocol = window.location.protocol;\r\n    let host = window.location.hostname;\r\n    let url = protocol + '//' + host;\r\n    return axios\r\n        .post(url + '/Projet_TER/API/Controllers/connexion.php', credentials)\r\n        .then(response => response.data.token)\r\n        .then(token => {\r\n            addItem('token', token);\r\n            return true;\r\n        });\r\n}\r\n\r\nexport function logout() {\r\n    removeItem('token');\r\n}\r\n\r\nfunction tokenIsValid(token) {\r\n    const decoded = jwt_decode(token);\r\n    const exp = decoded['exp']\r\n    console.log(exp);\r\n    return exp * 1000 > new Date().getTime();\r\n}\r\n\r\nfunction decodeToken(token){\r\n    return jwt_decode(token);\r\n}"]},"metadata":{},"sourceType":"module"}