{"ast":null,"code":"import axios from 'axios';\nimport jwt_decode from \"jwt-decode\";\nimport { addItem, getItem, removeItem } from \"./LocalStorage\"; //Vérifie la connexion avec le token\n\nexport function hasAuthenticated() {\n  const token = getItem('token');\n  const result = token ? tokenIsValid(token) : false;\n\n  if (false === result) {\n    removeItem('token');\n  }\n\n  return result;\n} //Vérifie le role admin du token\n\nexport function isAdminRole() {\n  const token = getItem('token');\n  const result = token ? tokenIsValid(token) : false;\n\n  if (false === result) {\n    removeItem('token');\n    return false;\n  }\n\n  if (true === result) {\n    const role = getRole(token);\n\n    if (role === \"administrator\") {\n      return true;\n    }\n  }\n\n  return false;\n} //Vérifie le role user du token\n\nexport function isUserRole() {\n  const token = getItem('token');\n  const result = token ? tokenIsValid(token) : false;\n\n  if (false === result) {\n    removeItem('token');\n    return false;\n  }\n\n  if (true === result) {\n    const role = getRole(token);\n\n    if (role === \"user\") {\n      return true;\n    }\n  }\n\n  return false;\n} //Vérifie le role superAdmin du token\n\nexport function isSuperAdminRole() {\n  const token = getItem('token');\n  const result = token ? tokenIsValid(token) : false;\n\n  if (false === result) {\n    removeItem('token');\n    return false;\n  }\n\n  if (true === result) {\n    const role = getRole(token);\n\n    if (role === \"super-admin\") {\n      return true;\n    }\n  }\n\n  return false;\n} //Récup du role du token décodé\n\nexport function getRole(token) {\n  const tokenResult = decodeToken(token);\n  return tokenResult['user_role'];\n} //Récupération du token + mise en localStorage\n\nexport function login(credentials) {\n  // const bcrypt = require('bcrypt');\n  // const saltRounds = 10;\n  let protocol = window.location.protocol;\n  let host = window.location.hostname;\n  let url = protocol + '//' + host;\n  hashPassword(); // const salt = bcrypt.genSaltSync(saltRounds);\n  // const hash = bcrypt.hashSync(credentials, salt);\n\n  console.log(credentials);\n  return axios.post(url + '/Projet_TER/API/Controllers/connexion.php', credentials).then(response => response.data.token).then(token => {\n    addItem('token', token);\n    return true;\n  });\n}\n\nfunction hashPassword() {\n  const bcrypt = require(\"bcryptjs\");\n\n  const password = \"1234\";\n  const saltRounds = 10;\n  bcrypt.genSalt(saltRounds, function (err, salt) {\n    if (err) {\n      throw err;\n    } else {\n      bcrypt.hash(password, salt, function (err, hash) {\n        if (err) {\n          throw err;\n        } else {\n          return hash;\n        }\n      });\n    }\n  });\n} //Supprime le token du localSTorage\n\n\nexport function logout() {\n  removeItem('token');\n} //Verifie validité du token (avec temps d'expiration)\n\nfunction tokenIsValid(token) {\n  const decoded = jwt_decode(token);\n  const exp = decoded['exp'];\n  return exp * 1000 > new Date().getTime();\n} //Traduit le token pour récupérer les infos\n\n\nfunction decodeToken(token) {\n  return jwt_decode(token);\n}","map":{"version":3,"sources":["C:/wamp64/www/Projet_TER/src/services/AuthApi.js"],"names":["axios","jwt_decode","addItem","getItem","removeItem","hasAuthenticated","token","result","tokenIsValid","isAdminRole","role","getRole","isUserRole","isSuperAdminRole","tokenResult","decodeToken","login","credentials","protocol","window","location","host","hostname","url","hashPassword","console","log","post","then","response","data","bcrypt","require","password","saltRounds","genSalt","err","salt","hash","logout","decoded","exp","Date","getTime"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport jwt_decode from \"jwt-decode\";\r\nimport {addItem, getItem, removeItem} from \"./LocalStorage\";\r\n\r\n//Vérifie la connexion avec le token\r\nexport function hasAuthenticated() {\r\n\r\n    const token = getItem('token');\r\n    const result = token ? tokenIsValid(token) : false;\r\n    if (false === result) {\r\n        removeItem('token');\r\n    }\r\n    return result;\r\n}\r\n\r\n//Vérifie le role admin du token\r\nexport function isAdminRole(){\r\n    const token = getItem('token');\r\n    const result = token ? tokenIsValid(token) : false;\r\n    if (false === result) {\r\n        removeItem('token');\r\n        return false;\r\n    }\r\n    if(true === result) {\r\n       const role = getRole(token);\r\n       if (role ===\"administrator\"){\r\n           return true;\r\n       }\r\n    }\r\n    return false;\r\n}\r\n//Vérifie le role user du token\r\nexport function isUserRole(){\r\n    const token = getItem('token');\r\n    const result = token ? tokenIsValid(token) : false;\r\n    if (false === result) {\r\n        removeItem('token');\r\n        return false;\r\n    }\r\n    if(true === result) {\r\n        const role = getRole(token);\r\n        if (role ===\"user\"){\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n//Vérifie le role superAdmin du token\r\nexport function isSuperAdminRole(){\r\n    const token = getItem('token');\r\n    const result = token ? tokenIsValid(token) : false;\r\n    if (false === result) {\r\n        removeItem('token');\r\n        return false;\r\n    }\r\n    if(true === result) {\r\n        const role = getRole(token);\r\n        if (role ===\"super-admin\"){\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n//Récup du role du token décodé\r\nexport function getRole(token){\r\n    const tokenResult = decodeToken(token);\r\n    return tokenResult['user_role'];\r\n}\r\n\r\n//Récupération du token + mise en localStorage\r\nexport function login(credentials) {\r\n    // const bcrypt = require('bcrypt');\r\n    // const saltRounds = 10;\r\n     let protocol = window.location.protocol;\r\n    let host = window.location.hostname;\r\n    let url = protocol + '//' + host;\r\n    hashPassword();\r\n    // const salt = bcrypt.genSaltSync(saltRounds);\r\n    // const hash = bcrypt.hashSync(credentials, salt);\r\n    console.log(credentials)\r\n    return axios\r\n        .post(url + '/Projet_TER/API/Controllers/connexion.php', credentials)\r\n        .then(response => response.data.token)\r\n        .then(token => {\r\n            addItem('token', token);\r\n            return true;\r\n        });\r\n}\r\n\r\n\r\nfunction hashPassword(){\r\n    const bcrypt = require(\"bcryptjs\")\r\n    const password = \"1234\"\r\n    const saltRounds = 10\r\n    bcrypt.genSalt(saltRounds, function (err, salt) {\r\n        if (err) {\r\n            throw err\r\n        } else {\r\n            bcrypt.hash(password, salt, function(err, hash) {\r\n                if (err) {\r\n                    throw err\r\n                } else {\r\n                    return hash;\r\n                }\r\n            })\r\n        }\r\n    })\r\n}\r\n//Supprime le token du localSTorage\r\nexport function logout() {\r\n    removeItem('token');\r\n}\r\n\r\n//Verifie validité du token (avec temps d'expiration)\r\nfunction tokenIsValid(token) {\r\n    const decoded = jwt_decode(token);\r\n    const exp = decoded['exp']\r\n    return exp * 1000 > new Date().getTime();\r\n}\r\n\r\n//Traduit le token pour récupérer les infos\r\nfunction decodeToken(token){\r\n    return jwt_decode(token);\r\n}"]},"metadata":{},"sourceType":"module"}