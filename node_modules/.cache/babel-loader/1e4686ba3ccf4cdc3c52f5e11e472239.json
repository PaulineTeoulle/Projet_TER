{"ast":null,"code":"import _slicedToArray from\"C:/wamp64/www/Projet_TER/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import $ from'jquery';import axios from'axios';import pdf from\"../public/pdf.svg\";import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faUpload,faTrash}from'@fortawesome/free-solid-svg-icons';import ModalConfirmation from'../components/modal/ModalConfirmation';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function FileUpload(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),allFiles=_useState4[0],setAllFiles=_useState4[1];function onSubmit(e){e.preventDefault();uploadFile(file);}function onChange(e){setFile(e.target.files[0]);}function uploadFile(file){var formData=new FormData();formData.append('file',file);var protocol=window.location.protocol;var host=window.location.hostname;var url=protocol+'//'+host;axios.post(url+'/API/Controllers/ressource/uploadFile.php',formData,{headers:{'content-type':'multipart/form-data'}}).then(function(response){if(response.data.Error){alert(response.data.Error);}loadFiles();setFile(null);}).catch(function(error){console.log(error);});}function openFile(name){var protocol=window.location.protocol;var host=window.location.hostname;var url=protocol+'//'+host;window.open(url+'/Projet_TER/src/public/documentsRessources/'+name);}function deleteFile(id){var protocol=window.location.protocol;var host=window.location.hostname;var url=protocol+'//'+host;var data=JSON.stringify({id:Number(id)});console.log(data);axios({method:'delete',url:url+'/API/Controllers/ressource/supprimerRessource.php',data:data}).then(function(response){return loadFiles();});}function loadFiles(){var protocol=window.location.protocol;var host=window.location.hostname;var url=protocol+'//'+host;axios.get(url+'/API/Controllers/ressource/lire.php').then(function(response){setAllFiles(response.data.ressources);});}useEffect(function(){if(file){$(\"form>label\").html(file.name);$(\"form>label\").css(\"color\",\"black\");}else{$(\"form>label\").html(\"Import file...\");$(\"form>label\").css(\"color\",\"lightgray\");}},[file]);useEffect(function(){if(!allFiles){loadFiles();}},[]);// Modal management\nvar _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modalOpen=_useState6[0],setModalOpen=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),selectedElement=_useState10[0],setSelectedElement=_useState10[1];function openModal(element){setModalOpen(true);setMessage(\"Do you want to delete \"+element.Nom+\" ?\");setSelectedElement(element.ID_Ressource);}function closeModal(){setModalOpen(false);}return/*#__PURE__*/_jsxs(\"div\",{className:\"FileUpload\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,children:[/*#__PURE__*/_jsx(\"button\",{className:\"filled submit-button\",type:\"submit\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUpload})}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file-upload\",children:\"Import file...\"}),/*#__PURE__*/_jsx(\"input\",{id:\"file-upload\",type:\"file\",onChange:onChange})]}),/*#__PURE__*/_jsx(\"h3\",{children:\" List of files already uploaded :\"}),allFiles&&/*#__PURE__*/_jsx(\"div\",{className:\"item-list\",children:allFiles.map(function(element,i){return/*#__PURE__*/_jsxs(\"div\",{className:\"item\",title:element.Nom,children:[/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){return openModal(element);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTrash})}),/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){return openFile(element.Nom);},src:pdf,alt:\"icon pdf\"}),/*#__PURE__*/_jsx(\"p\",{onClick:function onClick(){return openFile(element.Nom);},children:element.Nom})]},i);})})]}),/*#__PURE__*/_jsx(ModalConfirmation,{title:\"Warning\",message:message,open:modalOpen,close:closeModal,mainAction:deleteFile,mainActionParameters:selectedElement,mainActionName:\"Delete\"})]});}export default FileUpload;","map":{"version":3,"sources":["C:/wamp64/www/Projet_TER/src/views/FileUpload.js"],"names":["React","useEffect","useState","$","axios","FontAwesomeIcon","faUpload","faTrash","ModalConfirmation","FileUpload","props","file","setFile","allFiles","setAllFiles","onSubmit","e","preventDefault","uploadFile","onChange","target","files","formData","FormData","append","protocol","window","location","host","hostname","url","post","headers","then","response","data","Error","alert","loadFiles","catch","error","console","log","openFile","name","open","deleteFile","id","JSON","stringify","Number","method","get","ressources","html","css","modalOpen","setModalOpen","message","setMessage","selectedElement","setSelectedElement","openModal","element","Nom","ID_Ressource","closeModal","map","i","pdf"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\r\nimport $ from 'jquery';\r\nimport axios from 'axios';\r\nimport pdf from '../public/pdf.svg'\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faUpload, faTrash } from '@fortawesome/free-solid-svg-icons';\r\nimport ModalConfirmation from '../components/modal/ModalConfirmation';\r\n\r\nfunction FileUpload(props) {\r\n    const [file, setFile] = useState(null);\r\n    const [allFiles, setAllFiles] = useState(null);\r\n\r\n    function onSubmit(e) {\r\n        e.preventDefault()\r\n        uploadFile(file);\r\n    }\r\n\r\n    function onChange(e) {\r\n        setFile(e.target.files[0]);\r\n    }\r\n\r\n    function uploadFile(file) {\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        let protocol = window.location.protocol;\r\n        let host = window.location.hostname;\r\n        let url = protocol + '//' + host;\r\n        axios.post(url + '/API/Controllers/ressource/uploadFile.php', formData, {\r\n            headers: {\r\n                'content-type': 'multipart/form-data'\r\n            }\r\n        }).then(response =>{\r\n            if(response.data.Error){\r\n                alert(response.data.Error);\r\n            }   \r\n            loadFiles();\r\n            setFile(null);\r\n        }).catch(error =>{\r\n            console.log(error);\r\n        });\r\n    }\r\n\r\n    function openFile(name){\r\n        let protocol = window.location.protocol;\r\n        let host = window.location.hostname;\r\n        let url = protocol + '//' + host;\r\n        window.open(url + '/Projet_TER/src/public/documentsRessources/' + name);\r\n    }\r\n\r\n    function deleteFile(id){\r\n        let protocol = window.location.protocol;\r\n        let host = window.location.hostname;\r\n        let url = protocol + '//' + host;\r\n        let data = JSON.stringify({id: Number(id)});\r\n        console.log(data);\r\n        axios({\r\n            method: 'delete',\r\n            url: url+ '/API/Controllers/ressource/supprimerRessource.php',\r\n            data: data\r\n        }).then(response => loadFiles())\r\n    }\r\n\r\n    function loadFiles(){\r\n        let protocol = window.location.protocol;\r\n        let host = window.location.hostname;\r\n        let url = protocol + '//' + host;\r\n        axios.get(url + '/API/Controllers/ressource/lire.php')\r\n        .then(response =>{\r\n            setAllFiles(response.data.ressources)\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(file){\r\n            $(\"form>label\").html(file.name);\r\n            $(\"form>label\").css(\"color\", \"black\");\r\n        } else {\r\n            $(\"form>label\").html(\"Import file...\");\r\n            $(\"form>label\").css(\"color\", \"lightgray\");\r\n        }\r\n    }, [file]);\r\n\r\n    useEffect(() => {\r\n        if(!allFiles){\r\n            loadFiles();\r\n        }\r\n    }, []);\r\n\r\n    // Modal management\r\n    const [modalOpen, setModalOpen] = useState(false);\r\n    const [message, setMessage] = useState(null);\r\n    const [selectedElement, setSelectedElement] = useState(null);\r\n\r\n    function openModal(element) {\r\n        setModalOpen(true);\r\n        setMessage(\"Do you want to delete \" + element.Nom + \" ?\")\r\n        setSelectedElement(element.ID_Ressource)\r\n    }\r\n\r\n    function closeModal(){\r\n        setModalOpen(false);\r\n    }\r\n\r\n    return (\r\n        <div className=\"FileUpload\">\r\n            <div>\r\n                <form onSubmit={onSubmit}>\r\n                    <button className=\"filled submit-button\" type=\"submit\">                        \r\n                        <FontAwesomeIcon icon={faUpload} />\r\n                    </button>\r\n                    <label htmlFor=\"file-upload\">Import file...</label>\r\n                    <input id=\"file-upload\" type=\"file\" onChange={onChange}/>\r\n                </form>\r\n                <h3> List of files already uploaded :</h3>\r\n                {allFiles &&\r\n                    <div className=\"item-list\">\r\n                        {allFiles.map((element, i) => {   \r\n                            return (<div className=\"item\" title={element.Nom} key={i}>\r\n                                <p onClick={() => openModal(element)}><FontAwesomeIcon icon={faTrash} /></p>\r\n                                <img onClick={() => openFile(element.Nom)} src={pdf} alt=\"icon pdf\"/>\r\n                                <p onClick={() => openFile(element.Nom)}>{element.Nom}</p>\r\n                                </div>\r\n                            ) \r\n                            \r\n                        })}    \r\n                    </div>\r\n                }  \r\n            </div>\r\n\r\n            <ModalConfirmation\r\n                title=\"Warning\"\r\n                message={message}\r\n                open={modalOpen}  \r\n                close={closeModal}\r\n                mainAction={deleteFile}\r\n                mainActionParameters={selectedElement}\r\n                mainActionName=\"Delete\"\r\n            />\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FileUpload;\r\n"]},"metadata":{},"sourceType":"module"}