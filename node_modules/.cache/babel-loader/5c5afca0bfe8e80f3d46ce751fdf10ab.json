{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\Projet_TER\\\\src\\\\views\\\\Quiz.js\";\nimport React from 'react';\nimport axios from 'axios';\nimport Issues from '../components/quiz/issues';\nimport Historic from '../components/quiz/historic';\nimport Method from '../components/quiz/method';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class Quiz extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.changeData = (nextIssueId, decision = null, allChoices = null, historic = true, editHistoric = false) => {\n      // ID de la prochaine question\n      this.setState({\n        checkedDecision: decision\n      }); //  Vérifie si la décision renvoie une méthode\n\n      let method = this.checkMethod(decision);\n\n      if (method) {\n        this.manageMethod(decision, method);\n      } else {\n        // si ID prochaine question pas égal a 0 on récupère info\n        if (nextIssueId !== 0) {\n          if (allChoices) {\n            // si on est sur le critère de fin et qu'on continue, on reinitialise l'historique\n            let restart;\n            allChoices.forEach(element => {\n              let decision = this.state.tree.decisions.find(el => el.ID_Decision === element);\n\n              if (decision.ID_Critere_sortant === null) {\n                restart = true;\n              }\n            });\n\n            if (restart) {\n              this.setState({\n                historic: [],\n                step: 0\n              }, () => {\n                this.manageStoreData(nextIssueId, decision, historic, editHistoric);\n              });\n            } else {\n              this.manageStoreData(nextIssueId, decision, historic, editHistoric);\n            }\n          } else {\n            this.manageStoreData(nextIssueId, decision, historic, editHistoric);\n          }\n        } else {\n          alert(\"fini\");\n        }\n      }\n    };\n\n    this.manageStoreData = (nextIssueId, decision, historic, editHistoric) => {\n      // on va chercher la prochaine question et réponses\n      let issue = this.state.tree.criteres.find(critere => critere.ID_Critere === nextIssueId);\n      let decisions = this.state.tree.decisions.filter(decision => decision.ID_Critere_entrant === issue.ID_Critere);\n      let oldIssue = this.state.currentIssue;\n      this.setState({\n        currentIssue: issue,\n        currentDecisions: decisions,\n        step: this.state.step + 1\n      }, () => {\n        // on met a jour l'historique\n        if (historic) {\n          this.manageHistoric(decision, oldIssue);\n        }\n\n        if (editHistoric) {\n          let historicElement = {\n            issue: this.state.currentIssue,\n            decision: null\n          };\n          this.setState({\n            historic: this.state.historic.concat(historicElement)\n          });\n        }\n      });\n    };\n\n    this.manageMethod = (decision, method) => {\n      let newHistoric = this.state.historic.slice();\n      newHistoric[newHistoric.length - 1].decision = decision;\n      this.setState({\n        historic: newHistoric\n      });\n      let historicElement = {\n        method: method,\n        checked: false\n      };\n      this.setState({\n        historic: this.state.historic.concat(historicElement)\n      });\n    };\n\n    this.checkedMethod = (method, checked) => {\n      let index;\n      this.state.historic.forEach(element => {\n        if ('method' in element) {\n          if (element.method.ID_Methode === method.ID_Methode) {\n            index = this.state.historic.indexOf(element);\n          }\n        }\n      });\n      let historicElement = {\n        method: method,\n        checked: checked\n      };\n      let newHistoric = this.state.historic.slice();\n      newHistoric[index] = historicElement;\n      this.setState({\n        historic: newHistoric\n      });\n    };\n\n    this.checkMethod = decision => {\n      if (decision) {\n        let method = this.state.tree.methodes.find(methode => methode.ID_Decision === decision.ID_Decision);\n\n        if (method) {\n          this.setState({\n            currentMethod: method\n          });\n          return method;\n        }\n      }\n    };\n\n    this.backOut = (ID, type) => {\n      // si on retroune a une question\n      if (type === 'issue') {\n        // si au moment ou on retourne on est sur une méthode\n        if (this.state.currentMethod) {\n          this.setState({\n            currentMethod: null\n          }, () => {\n            this.backIssue(ID);\n          });\n        } else {\n          this.backIssue(ID);\n        }\n      } else {\n        // si on retourne a une méthode\n        let index = this.state.historic.indexOf(this.state.historic.find(el => el.method));\n        let decisionBeforeMethod = this.state.historic[index - 1].decision;\n        this.state.historic.length = index;\n        this.setState({\n          step: index\n        });\n        this.changeData(decisionBeforeMethod.ID_Critere_sortant, decisionBeforeMethod, null, false);\n      }\n    };\n\n    this.backIssue = ID => {\n      let index;\n      this.changeData(ID, null, null, false);\n      this.state.historic.forEach(element => {\n        if ('issue' in element) {\n          if (element.issue.ID_Critere === ID) {\n            index = this.state.historic.indexOf(element);\n          }\n        }\n      }); // let index =  this.state.historic.indexOf(this.state.historic.find(el => el.issue.ID_Critere === ID));\n\n      this.state.historic.length = index + 1;\n      this.state.historic[index].decision = null;\n      this.setState({\n        step: index + 1\n      });\n    };\n\n    this.manageHistoric = (decision = null, oldIssue) => {\n      // si nous ne somme aps sur une méthode\n      this.state.historic.forEach(element => {\n        if ('issue' in element) {\n          if (element.issue.ID_Critere === oldIssue.ID_Critere) {\n            element.decision = decision;\n          }\n        }\n      }); // on ajoute le nouveau critère sans décision dans l'historique\n\n      let historicElement = {\n        issue: this.state.currentIssue,\n        decision: null\n      };\n      this.setState({\n        historic: this.state.historic.concat(historicElement)\n      });\n    };\n\n    this.resumeQuiz = () => {\n      this.setState({\n        currentMethod: null\n      }, () => {\n        this.changeData(this.state.checkedDecision.ID_Critere_sortant, null, null, false, true);\n      });\n    };\n\n    this.state = {\n      tree: null,\n      checkedDecision: null,\n      currentMethod: null,\n      currentIssue: null,\n      currentDecisions: [],\n      historic: [],\n      step: 0\n    }; // this.componentDidMount = this.componentDidMount.bind(this);\n  } // met a jour le questionnaire\n  // historic : met a jour l'historique normalement\n  // editHistoric : met a jour artificiellement quand on est sur une méthode (arret du flux)\n\n\n  componentDidMount() {\n    let protocol = window.location.protocol;\n    let host = window.location.hostname;\n    let url = protocol + '//' + host;\n\n    if (!this.state.tree) {\n      axios.get(url + '/reactTest/MATUI/API/Controllers/lireArbre.php').then(response => {\n        console.log(response);\n        this.setState({\n          tree: response.data\n        });\n        this.changeData(response.data.entree[0].ID_Critere);\n      }).catch(error => console.log(error));\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Quiz\",\n      children: [this.state.currentMethod ? /*#__PURE__*/_jsxDEV(Method, {\n        method: this.state.currentMethod,\n        checkedDecision: this.state.checkedDecision,\n        changeData: this.changeData,\n        resumeQuiz: this.resumeQuiz,\n        checkedMethod: this.checkedMethod,\n        historic: this.state\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 23\n      }, this) : /*#__PURE__*/_jsxDEV(Issues, {\n        issue: this.state.currentIssue,\n        decisions: this.state.currentDecisions,\n        changeData: this.changeData,\n        step: this.state.step\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 22\n      }, this), /*#__PURE__*/_jsxDEV(Historic, {\n        historic: this.state.historic,\n        backOut: this.backOut\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }, this);\n  }\n\n}\nexport default Quiz;","map":{"version":3,"sources":["C:/wamp64/www/Projet_TER/src/views/Quiz.js"],"names":["React","axios","Issues","Historic","Method","Quiz","Component","constructor","props","changeData","nextIssueId","decision","allChoices","historic","editHistoric","setState","checkedDecision","method","checkMethod","manageMethod","restart","forEach","element","state","tree","decisions","find","el","ID_Decision","ID_Critere_sortant","step","manageStoreData","alert","issue","criteres","critere","ID_Critere","filter","ID_Critere_entrant","oldIssue","currentIssue","currentDecisions","manageHistoric","historicElement","concat","newHistoric","slice","length","checked","checkedMethod","index","ID_Methode","indexOf","methodes","methode","currentMethod","backOut","ID","type","backIssue","decisionBeforeMethod","resumeQuiz","componentDidMount","protocol","window","location","host","hostname","url","get","then","response","console","log","data","entree","catch","error","render"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport axios from 'axios';\r\n\r\nimport Issues from '../components/quiz/issues';\r\nimport Historic from '../components/quiz/historic';\r\nimport Method from '../components/quiz/method';\r\n\r\n\r\nexport class Quiz extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            tree : null,\r\n            checkedDecision: null,\r\n            currentMethod: null,\r\n            currentIssue: null,\r\n            currentDecisions: [],\r\n            historic: [],\r\n            step: 0,\r\n        };\r\n        // this.componentDidMount = this.componentDidMount.bind(this);\r\n    }\r\n\r\n\r\n    // met a jour le questionnaire\r\n    // historic : met a jour l'historique normalement\r\n    // editHistoric : met a jour artificiellement quand on est sur une méthode (arret du flux)\r\n    changeData = (nextIssueId, decision = null, allChoices = null, historic = true, editHistoric = false) => {\r\n        // ID de la prochaine question\r\n        this.setState({checkedDecision: decision});\r\n\r\n        //  Vérifie si la décision renvoie une méthode\r\n        let method = this.checkMethod(decision);\r\n\r\n        if(method){\r\n            this.manageMethod(decision, method);\r\n        } else {\r\n            // si ID prochaine question pas égal a 0 on récupère info\r\n            if(nextIssueId !== 0){\r\n                if(allChoices){\r\n                    // si on est sur le critère de fin et qu'on continue, on reinitialise l'historique\r\n                    let restart;\r\n                    allChoices.forEach(element => {\r\n                        let decision = this.state.tree.decisions.find(el => el.ID_Decision === element);\r\n                        if(decision.ID_Critere_sortant === null){\r\n                            restart = true;\r\n                        }\r\n                    });\r\n\r\n                    if(restart){\r\n                        this.setState({\r\n                            historic: [],\r\n                            step: 0,\r\n                        }, () => {\r\n                            this.manageStoreData(nextIssueId, decision, historic, editHistoric);\r\n                        });\r\n                    } else {\r\n                        this.manageStoreData(nextIssueId, decision, historic, editHistoric);\r\n                    }\r\n                } else {\r\n                    this.manageStoreData(nextIssueId, decision, historic, editHistoric);\r\n                }\r\n            }else {\r\n                alert(\"fini\");\r\n            }\r\n        }\r\n    }\r\n\r\n    manageStoreData = (nextIssueId, decision, historic, editHistoric) => {\r\n        // on va chercher la prochaine question et réponses\r\n        let issue = this.state.tree.criteres.find(critere => critere.ID_Critere === nextIssueId);\r\n        let decisions =  this.state.tree.decisions.filter(decision => decision.ID_Critere_entrant === issue.ID_Critere);\r\n        let oldIssue = this.state.currentIssue;\r\n        this.setState({\r\n            currentIssue: issue,\r\n            currentDecisions: decisions,\r\n            step: this.state.step + 1\r\n        }, () => {\r\n            // on met a jour l'historique\r\n            if(historic){\r\n                this.manageHistoric(decision, oldIssue)\r\n            }\r\n            if(editHistoric){\r\n                let historicElement = {\r\n                    issue: this.state.currentIssue,\r\n                    decision: null\r\n                }\r\n                this.setState({historic: this.state.historic.concat(historicElement)});  \r\n            }\r\n        });    \r\n    }\r\n\r\n    // on ajoute la méthode dans l'historique\r\n    manageMethod = (decision, method) => {\r\n        let newHistoric = this.state.historic.slice();\r\n        newHistoric[newHistoric.length - 1].decision = decision;\r\n        this.setState({historic: newHistoric}); \r\n\r\n        let historicElement = {\r\n            method: method,\r\n            checked: false\r\n        }\r\n        this.setState({historic: this.state.historic.concat(historicElement)}); \r\n    }\r\n\r\n    checkedMethod = (method, checked) => {\r\n        let index;\r\n        this.state.historic.forEach(element => {\r\n            if('method' in element){\r\n                if(element.method.ID_Methode === method.ID_Methode){\r\n                    index = this.state.historic.indexOf(element);\r\n                }\r\n            }\r\n        });\r\n        let historicElement = {\r\n            method: method,\r\n            checked: checked\r\n        }\r\n        let newHistoric = this.state.historic.slice();\r\n        newHistoric[index] = historicElement;\r\n        this.setState({historic: newHistoric}); \r\n    }\r\n\r\n    // on regarde si une méthode est associé a la décision prise\r\n    checkMethod = (decision) => {\r\n        if(decision){\r\n            let method = this.state.tree.methodes.find(methode => methode.ID_Decision === decision.ID_Decision);\r\n            if(method){\r\n                this.setState({currentMethod: method});\r\n                return method;\r\n            }\r\n        }\r\n    }\r\n\r\n    // on retourne dans l'historique \r\n    backOut = (ID, type) => {\r\n        // si on retroune a une question\r\n        if(type === 'issue'){\r\n            // si au moment ou on retourne on est sur une méthode\r\n            if(this.state.currentMethod){\r\n                this.setState({currentMethod: null}, () => {\r\n                    this.backIssue(ID);\r\n                })\r\n            } else {\r\n                this.backIssue(ID);\r\n            }\r\n        } else {\r\n            // si on retourne a une méthode\r\n            let index =  this.state.historic.indexOf(this.state.historic.find(el => el.method));\r\n            let decisionBeforeMethod = this.state.historic[index - 1].decision;   \r\n            this.state.historic.length = index;\r\n            this.setState({step: index});\r\n            this.changeData(decisionBeforeMethod.ID_Critere_sortant, decisionBeforeMethod, null, false);\r\n        }\r\n    }\r\n\r\n    // on rebind les bonne data en fonction de l'ID du critère sélectionné dans l'historique\r\n    backIssue = (ID) => {\r\n        let index;\r\n        this.changeData(ID, null, null, false);\r\n        this.state.historic.forEach(element => {\r\n            if('issue' in element){\r\n                if(element.issue.ID_Critere === ID){\r\n                    index = this.state.historic.indexOf(element);\r\n                }\r\n            }\r\n        });\r\n        // let index =  this.state.historic.indexOf(this.state.historic.find(el => el.issue.ID_Critere === ID));\r\n        this.state.historic.length = index + 1;\r\n        this.state.historic[index].decision = null;\r\n        this.setState({step: index + 1});\r\n    }\r\n\r\n    // on gère l'historique\r\n    manageHistoric = (decision = null, oldIssue) => {\r\n        // si nous ne somme aps sur une méthode\r\n        this.state.historic.forEach(element => {\r\n            if('issue' in element){\r\n                if(element.issue.ID_Critere === oldIssue.ID_Critere){\r\n                    element.decision = decision;\r\n                }\r\n            }\r\n        });\r\n\r\n        // on ajoute le nouveau critère sans décision dans l'historique\r\n        let historicElement = {\r\n            issue: this.state.currentIssue,\r\n            decision: null\r\n        }\r\n        this.setState({historic: this.state.historic.concat(historicElement)}); \r\n    }\r\n\r\n    // on reprend le questionnaire la ou on en était depuis une méthode\r\n    resumeQuiz = () => {\r\n        this.setState({currentMethod: null}, () => {\r\n            this.changeData(this.state.checkedDecision.ID_Critere_sortant, null, null, false, true);\r\n        });\r\n    }\r\n\r\n    componentDidMount(){\r\n        let protocol = window.location.protocol;\r\n        let host = window.location.hostname;\r\n        let url = protocol + '//' + host;\r\n\r\n        if(!this.state.tree){\r\n            axios.get(url + '/reactTest/MATUI/API/Controllers/lireArbre.php')\r\n            .then(response => {\r\n                console.log(response)\r\n                this.setState({tree: response.data});\r\n                this.changeData(response.data.entree[0].ID_Critere);\r\n            })\r\n            .catch(error => console.log(error))\r\n        }\r\n    };\r\n\r\n    render(){\r\n        return (\r\n            <div className=\"Quiz\">\r\n                {this.state.currentMethod\r\n                    ? <Method method={this.state.currentMethod}\r\n                        checkedDecision={this.state.checkedDecision}\r\n                        changeData={this.changeData}  \r\n                        resumeQuiz={this.resumeQuiz} \r\n                        checkedMethod={this.checkedMethod}\r\n                        historic={this.state}\r\n                    />\r\n                    :<Issues issue={this.state.currentIssue} \r\n                        decisions={this.state.currentDecisions} \r\n                        changeData={this.changeData}\r\n                        step={this.state.step}\r\n                    />\r\n                }\r\n                <Historic historic={this.state.historic} \r\n                    backOut={this.backOut}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport default Quiz;\r\n"]},"metadata":{},"sourceType":"module"}